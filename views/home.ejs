<!DOCTYPE html>
<html>

<head>
    <title>Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Include Tailwind CSS from CDN for styling -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.1.2/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css">
    <link rel="stylesheet" type="text/css" href="static/styles.css" />
    <link rel="icon" type="image/png" href="images/favicon.ico">

</head>

<body class="bg-gray-200">
    <div class="flex flex-col min-h-screen">
        <header class="text-center py-5">
            <div class="flex flex-col items-center">
                <h1 class="text-3xl font-bold"><a href="/blog">Surya Polina</a></h1>
            </div>
            <nav class="mt-4">
                <a href="/blog" class="text-blue-800 hover:text-blue-700 mx-2">Blog</a>
                <a href="/gallery" class="text-blue-800 hover:text-blue-700 mx-2">Gallery</a>
                <a href="/portfolio" class="text-blue-800 hover:text-blue-700 mx-2">Portfolio</a>
            </nav>
        </header>

        <main class="flex-grow">
            <div class="container mx-auto px-4">
                <div class="flex flex-wrap -mx-4">
                    <% posts.forEach(function(post, index) { %>
                        <div class="w-full sm:w-1/2 md:w-1/3 px-4 mb-8">
                            <div class="bg-white shadow-lg cursor-pointer hover:bg-blue-100 overflow-hidden" onclick="openModal(this)" 
                                data-title="<%= post.title %>"
                                data-text="<%= post.text %>"
                                data-date-created="<%= post.date_created %>"
                                data-image-path="<%= post.imagePath %>"
                                data-tags="<%= post.tags.join(',') %>"
                                id="post-<%= index %>">
                                <h2 class="text-xl font-bold p-4"><%= post.title %></h2>
                                
                                <% if (post.imagePath) { %>
                                    <img src="<%= post.imagePath %>" alt="Thumbnail" class="w-full">
                                <% } %>
                                
                                <div class="p-4">
                                    <p class="mb-2"><%= post.preview %></p>
                                    <p class="text-gray-500 text-sm mb-2"><%= new Date(post.date_created).toLocaleDateString() %></p>
                                    
                                    <div class="flex flex-wrap gap-2">
                                        <% post.tags.forEach(function(tag) { %>
                                            <a href="/tag/<%= tag %>" class="bg-gray-200 rounded-full px-3 py-1 text-sm font-semibold text-gray-700 hover:bg-gray-300"
                                                onclick="event.stopPropagation();">
                                                <%= tag %>
                                            </a>
                                        <% }) %>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                </div>
            </div>
        </main>

        <!-- Modal -->
        <div id="modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto" onclick="closeModal()" >
            <div class="relative top-20 mx-auto p-4 border shadow-lg bg-white">
                <div class="flex items-center justify-between">
                    <!-- Left arrow for previous blog post -->
                    <button id="prevButton" onclick="loadPrevious(event)">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    
                    <!-- Right arrow for next blog post -->
                    <button id="nextButton" onclick="loadNext(event)">
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>

                <!-- Blog Title -->
                <div id="modal-title" class="text-xl font-bold mt-4"> </div>

                <!-- Blog Content -->
                <div id="modal-content" class="mt-3 text-center">
                    <!-- Dynamic content will be loaded here -->
                </div>   
                <!-- Tags container -->
                <div id="modal-tags" class="mt-3">
                    <!-- Tags will be added here by JavaScript -->
                </div>
                <div class="items-center px-4 py-3">
                    <button id="closeBtn" class="px-4 py-2 bg-gray-800 text-white text-base font-medium w-full shadow-sm" onclick="closeModal()">Close</button>
                </div>
            </div>
        </div>

        <footer class="mt-auto bg-indigo-100">
            <div class="text-center py-5">
                <div class="flex justify-center space-x-4 mb-4"> <!-- Adjust the space-x-* and mb-* to your liking -->
                    <a href="mailto:thesuryapolina@gmail.com" class="text-gray-600 hover:text-black">
                        <i class="fas fa-envelope fa-lg"></i>
                    </a>
                    <a href="https://github.com/surpol" target="_blank" class="text-gray-600 hover:text-black">
                        <i class="fab fa-github fa-lg"></i>
                    </a>
                    <a href="https://twitter.com/suryapolina" target="_blank" class="text-blue-400 hover:text-blue-500">
                        <i class="fab fa-twitter fa-lg"></i>
                    </a>
                    <a href="https://instagram.com/surya_polina" target="_blank" class="text-pink-600 hover:text-pink-700">
                        <i class="fab fa-instagram fa-lg"></i>
                    </a>
                </div>
                <p>All rights reserved. &copy; Surya Polina</p>
            </div>
        </footer>

    </div>
<!----Javascript---->
    <script>
        // Add two new global variables to keep track of the current post index and total posts
        var currentPostIndex = 0;
        var totalPosts = <%= posts.length %>;

        function openModal(element) {
            currentPostIndex = parseInt(element.id.replace('post-', ''));
            const title = element.getAttribute('data-title');
            const text = element.getAttribute('data-text');
            const dateCreated = element.getAttribute('data-date-created');
            const tagsString = element.getAttribute('data-tags'); // Ensure this attribute is set with the tags
            const tags = tagsString ? tagsString.split(',') : [];

            const modal = document.getElementById('modal');
            const modalContent = modal.querySelector('#modal-content');
            const modalTagsContainer = modal.querySelector('#modal-tags'); // Make sure this container exists in your modal HTML

            // Clear previous content
            modalContent.innerHTML = '';
            modalTagsContainer.innerHTML = ''; // Clear any existing tags

            // Create and append the title element
            const titleElement = document.createElement('h2');
            titleElement.textContent = title;
            titleElement.className = 'text-2xl font-bold';
            modalContent.appendChild(titleElement);

            // Create and append the text content element
            const textElement = document.createElement('div');
            textElement.innerHTML = text;
            textElement.className = 'mt-4 text-left'; // Use Tailwind classes
            modalContent.appendChild(textElement);

            // Generate and append tags
            tags.forEach(tag => {
                const tagElement = document.createElement('span');
                tagElement.textContent = tag.trim();
                tagElement.className = 'inline-block bg-gray-200 rounded-full px-3 py-1 text-sm font-semibold text-gray-700 mr-2 mb-2'; // Use Tailwind classes
                modalTagsContainer.appendChild(tagElement);
            });

            // Append tags container to modal content if it's not already there
            if (!modalTagsContainer.parentNode) {
                modalContent.appendChild(modalTagsContainer);
            }

            // Show the modal
            modal.style.display = 'block';
        }

        function loadPrevious(event) {
            // Stop click event from reaching the modal overlay
            event.stopPropagation();
            if (currentPostIndex > 0) {
                openModal(document.getElementById(`post-${currentPostIndex - 1}`));
            }
        }

        function loadNext(event) {
            // Stop click event from reaching the modal overlay
            event.stopPropagation();
            if (currentPostIndex < totalPosts - 1) {
                openModal(document.getElementById(`post-${currentPostIndex + 1}`));
            }
        }

        // Function to close the modal
        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

    </script>
</body>
</html>
